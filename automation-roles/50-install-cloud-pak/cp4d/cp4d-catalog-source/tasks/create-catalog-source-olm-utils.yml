---
- name: Ensure that OLM utils work directory exists
  file:
    path: /tmp/work
    state: directory

- name: Delete offline directory
  file:
    path: /tmp/work/offline
    state: absent

- name: If air-gapped, copy case files from {{ status_dir }}/work/offline to /tmp/work/offline
  copy:
    src: "{{ status_dir }}/work/offline"
    dest: /tmp/work/
    remote_src: True
  when: (cpd_airgap | default(False) | bool)

- name: Generate OLM command to create catalog sources for Cloud Pak for Data {{ _p_catsrc_scope }}
  set_fact:
    _apply_olm_command: "{{ lookup('template', 'apply-olm-create-catsrc.j2') }}" 
  vars:
    _p_preview_script: False

- include_role:
    name: run-command
  vars:
    _p_command_description: Create catalog sources for {{ _p_catsrc_scope }}
    _p_command: "{{ _apply_olm_command }}"
    _p_command_log_file: "{{ status_dir }}/log/apply-olm-create-catsrc-{{ _p_catsrc_scope }}.log"

- name: If not air-gapped, copy case files from /tmp/work/offline to {{ status_dir }}/work/offline
  copy:
    src: /tmp/work/offline
    dest: "{{ status_dir }}/work/"
    remote_src: True
  when: 
  - not (cpd_airgap | default(False) | bool)
  - not cpd_dry_run