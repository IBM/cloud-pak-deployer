---
- include_role:
    name: run-command
  vars:
    _p_command_description: Install cluster-scoped resources using file {{ status_dir }}/work/cluster_scoped_resources.yaml
    _p_command: "{{ lookup('template','apply_cluster_scoped_forced.j2') }}"
    _p_command_log_file: "{{ status_dir }}/log/{{ current_cp4d_cluster.project }}-apply-cluster-scoped-resources.log"

- block:
  - name: Generate install-components command for project {{ current_cp4d_cluster.project }} to install Software Hub
    set_fact:
      _install_components: "{{ lookup('template','install-components.j2') }}"

  - include_role:
      name: run-command
    vars:
      _p_command_description: Install Software Hub into project {{ current_cp4d_cluster.project }}
      _p_command: "{{ _install_components }}"
      _p_command_log_file: "{{ status_dir }}/log/{{ current_cp4d_cluster.project }}-install-software-hub.log"
      _p_command_environment:
        OLM_UTILS_IMAGE: "{{ _olm_utils_image_full }}"
      _p_cpd_cli_manage: True
  when: _install_control_plane