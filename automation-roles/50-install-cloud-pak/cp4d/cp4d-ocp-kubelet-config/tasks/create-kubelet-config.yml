---
- name: Delete KubeletConfig cpd-crio-kubeletconfig if it exists
  shell: |
    oc delete KubeletConfig cpd-crio-kubeletconfig --ignore-not-found
  when: not cpd_dry_run
    
- name: Create KubeletConfig yaml
  template:
    src: cp4d-kubeletconfig.j2
    dest: "{{ status_dir }}/openshift/cp4d-kubeletconfig.yaml"

- include_role:
    name: log-deployer-activity
  vars:
    _p_activity_description: "Create KubeletConfig"
    _p_activity_yaml: "{{ status_dir }}/openshift/cp4d-kubeletconfig.yaml"

- name: Create KubeletConfig {{ kubelet_config_name }}
  shell: |
    oc apply -f {{ status_dir }}/openshift/cp4d-kubeletconfig.yaml
  when: not cpd_dry_run

- name: Label worker machine config pool to allow KubeletConfig
  shell: |
    oc label machineconfigpool worker db2u-kubelet=sysctl --overwrite
  when: 
  - _existing_ocp_infra_type != 'aws-rosa'
  - not cpd_dry_run
