---
- set_fact:
<<<<<<< HEAD
    _template_file: installation-options-custom-spec.j2
    
- set_fact:
    _template_file: installation-options-root.j2
  when: _root_options | default(False)

- name: Insert {{ _cartridge_name }} installation options into {{ status_dir }}/cp4d/{{ _p_current_cp4d_cluster.project }}-install-options.yml
  blockinfile:
    path: "{{ status_dir }}/cp4d/{{ _p_current_cp4d_cluster.project }}-install-options.yml"
    marker: "# {mark} {{ _cartridge_name }} options #"
    block: |
        {{ lookup('template', _template_file) }}
  vars:
    _installation_options: "{{ _current_cp4d_cartridge.installation_options }}"
  when: (_current_cp4d_cartridge.installation_options | default({})) != {}
=======
    _installation_options_section: ''

- set_fact:
    _installation_options_section: 'custom_spec'
  when: 
  - _p_cp4d_version < '5.3.0'
  - not (_current_cp4d_cartridge.installation_options_root | default(False))

- set_fact:
    _installation_options_section: "{{ _current_cp4d_cartridge.installation_options_section | default('non_olm') }}"
  when: _p_cp4d_version >= '5.3.0'

- include_role:
    name: cp4d-installation-options
  vars:
    _p_cp4d_project: "{{ _p_current_cp4d_cluster.project }}"
    _p_current_cp4d_cartridge: "{{ _current_cp4d_cartridge }}"
    _p_cartridge_name: "{{ _current_cp4d_cartridge.olm_utils_name }}"
    _p_section: "{{ _installation_options_section }}"
    _p_installation_options: "{{ _current_cp4d_cartridge.installation_options }}"
  when: ( _current_cp4d_cartridge.installation_options | default({})) != {}
>>>>>>> main
