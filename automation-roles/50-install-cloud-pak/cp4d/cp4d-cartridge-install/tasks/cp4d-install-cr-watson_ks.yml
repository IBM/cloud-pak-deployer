---
- include_tasks: cp4d-setup-mcg-secrets.yml
  when: _p_current_cp4d_cluster.cp4d_version >= "4.7.0"
  
- name: Prepare yaml file for Watson Knowledge Studio CR
  template:
    src: watson-ks-cr-45.j2
    dest: "{{ status_dir }}/cp4d/watson-ks-cr-45-{{ _p_current_cp4d_cluster.project }}.yml"

- include_role:
    name: log-deployer-activity
  vars:
    _p_activity_description: "Create Watson Knowledge Studio CR"
    _p_activity_yaml: "{{ status_dir }}/cp4d/watson-ks-cr-45-{{ _p_current_cp4d_cluster.project }}.yml"

- name: Create Watson Knowledge Studio CR
  shell: |
    oc apply -f {{ status_dir }}/cp4d/watson-ks-cr-45-{{ _p_current_cp4d_cluster.project }}.yml
  when: not cpd_dry_run