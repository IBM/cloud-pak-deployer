---
- name: Get stored password for keycloak user {{ _current_keycloak_user.username }}
  include_role:
    name: vault-get-secret
  vars:
    secret_name: "{{ _keycloak_name }}-{{ _current_keycloak_user.username }}"
    secret_group: "{{ environment_name }}"

- set_fact:
    _keycloak_user_password:
      username: "{{ _current_keycloak_user.username }}"
      password: "{{ secret_value }}"

- set_fact:
    _keycloak_users_passwords: "{{ _keycloak_users_passwords + [_keycloak_user_password] }}"