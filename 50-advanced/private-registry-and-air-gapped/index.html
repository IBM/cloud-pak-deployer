<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Automated deployer of OpenShift cluster and IBM Cloud Paks"><meta name=author content=Author><link href=https://ibm.github.io/cloud-pak-deployer/50-advanced/private-registry-and-air-gapped/ rel=canonical><link href=../build-image-and-run-deployer-on-openshift/ rel=prev><link href=../alternative-repo-reg/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.2"><title>Private registry and air-gapped - Cloud Pak Deployer</title><link rel=stylesheet href=../../assets/stylesheets/main.484c7ddc.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../css/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#using-a-private-registry class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Cloud Pak Deployer" class="md-header__button md-logo" aria-label="Cloud Pak Deployer" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Cloud Pak Deployer </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Private registry and air-gapped </span> </div> </div> </div> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/IBM/cloud-pak-deployer title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> Cloud Pak Deployer </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Cloud Pak Deployer" class="md-nav__button md-logo" aria-label="Cloud Pak Deployer" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> Cloud Pak Deployer </label> <div class=md-nav__source> <a href=https://github.com/IBM/cloud-pak-deployer title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> Cloud Pak Deployer </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../01-introduction/current-state-and-support/ class=md-nav__link> <span class=md-ellipsis> Current state </span> </a> </li> <li class=md-nav__item> <a href=../../05-install/install/ class=md-nav__link> <span class=md-ellipsis> Installing Cloud Pak Deployer </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Using Cloud Pak Deployer </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Using Cloud Pak Deployer </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../10-use-deployer/1-overview/overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex=0> <span class=md-ellipsis> Run </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Run </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../10-use-deployer/3-run/run/ class=md-nav__link> <span class=md-ellipsis> Running Cloud Pak Deployer </span> </a> </li> <li class=md-nav__item> <a href=../../10-use-deployer/3-run/existing-openshift/ class=md-nav__link> <span class=md-ellipsis> Existing OpenShift </span> </a> </li> <li class=md-nav__item> <a href=../../10-use-deployer/3-run/existing-openshift-console/ class=md-nav__link> <span class=md-ellipsis> Existing OpenShift using Console </span> </a> </li> <li class=md-nav__item> <a href=../../10-use-deployer/3-run/existing-openshift-wizard/ class=md-nav__link> <span class=md-ellipsis> Existing OpenShift using Deployer Wizard </span> </a> </li> <li class=md-nav__item> <a href=../../10-use-deployer/3-run/ibm-cloud/ class=md-nav__link> <span class=md-ellipsis> IBM Cloud </span> </a> </li> <li class=md-nav__item> <a href=../../10-use-deployer/3-run/ibm-fusion/ class=md-nav__link> <span class=md-ellipsis> IBM Fusion </span> </a> </li> <li class=md-nav__item> <a href=../../10-use-deployer/3-run/aws-rosa/ class=md-nav__link> <span class=md-ellipsis> AWS ROSA </span> </a> </li> <li class=md-nav__item> <a href=../../10-use-deployer/3-run/aws-self-managed/ class=md-nav__link> <span class=md-ellipsis> AWS Self-managed </span> </a> </li> <li class=md-nav__item> <a href=../../10-use-deployer/3-run/azure-aro/ class=md-nav__link> <span class=md-ellipsis> Azure ARO </span> </a> </li> <li class=md-nav__item> <a href=../../10-use-deployer/3-run/azure-self-managed/ class=md-nav__link> <span class=md-ellipsis> Azure Self-managed </span> </a> </li> <li class=md-nav__item> <a href=../../10-use-deployer/3-run/vsphere/ class=md-nav__link> <span class=md-ellipsis> vSphere </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3 id=__nav_4_3_label tabindex=0> <span class=md-ellipsis> Post-run </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> Post-run </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../10-use-deployer/5-post-run/post-run/ class=md-nav__link> <span class=md-ellipsis> Post-run changes </span> </a> </li> <li class=md-nav__item> <a href=../../10-use-deployer/7-command/command/ class=md-nav__link> <span class=md-ellipsis> Running commands </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_4> <label class=md-nav__link for=__nav_4_4 id=__nav_4_4_label tabindex=0> <span class=md-ellipsis> Destroy </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> Destroy </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../10-use-deployer/9-destroy/destroy/ class=md-nav__link> <span class=md-ellipsis> Destroy cluster </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Reference </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_1> <label class=md-nav__link for=__nav_5_1 id=__nav_5_1_label tabindex=0> <span class=md-ellipsis> Configuration </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_1_label aria-expanded=false> <label class=md-nav__title for=__nav_5_1> <span class="md-nav__icon md-icon"></span> Configuration </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../30-reference/configuration/topologies/ class=md-nav__link> <span class=md-ellipsis> Topologies </span> </a> </li> <li class=md-nav__item> <a href=../../30-reference/configuration/cpd-objects/ class=md-nav__link> <span class=md-ellipsis> Objects overview </span> </a> </li> <li class=md-nav__item> <a href=../../30-reference/configuration/cpd-global-config/ class=md-nav__link> <span class=md-ellipsis> Global config </span> </a> </li> <li class=md-nav__item> <a href=../../30-reference/configuration/vault/ class=md-nav__link> <span class=md-ellipsis> Vault </span> </a> </li> <li class=md-nav__item> <a href=../../30-reference/configuration/infrastructure/ class=md-nav__link> <span class=md-ellipsis> Infrastructure </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_1_6> <label class=md-nav__link for=__nav_5_1_6 id=__nav_5_1_6_label tabindex=0> <span class=md-ellipsis> OpenShift </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_5_1_6_label aria-expanded=false> <label class=md-nav__title for=__nav_5_1_6> <span class="md-nav__icon md-icon"></span> OpenShift </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../30-reference/configuration/openshift/ class=md-nav__link> <span class=md-ellipsis> OpenShift </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_1_6_2> <label class=md-nav__link for=__nav_5_1_6_2 id=__nav_5_1_6_2_label tabindex=0> <span class=md-ellipsis> Identity and Access Management </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_5_1_6_2_label aria-expanded=false> <label class=md-nav__title for=__nav_5_1_6_2> <span class="md-nav__icon md-icon"></span> Identity and Access Management </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../30-reference/configuration/redhat-sso/ class=md-nav__link> <span class=md-ellipsis> Red Hat SSO </span> </a> </li> <li class=md-nav__item> <a href=../../30-reference/configuration/ldap/ class=md-nav__link> <span class=md-ellipsis> LDAP </span> </a> </li> <li class=md-nav__item> <a href=../../30-reference/configuration/demo-openldap/ class=md-nav__link> <span class=md-ellipsis> Demo OpenLDAP </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../30-reference/configuration/ibm-storage/ class=md-nav__link> <span class=md-ellipsis> IBM Storage </span> </a> </li> <li class=md-nav__item> <a href=../../30-reference/configuration/monitoring/ class=md-nav__link> <span class=md-ellipsis> Monitoring </span> </a> </li> <li class=md-nav__item> <a href=../../30-reference/configuration/logging-auditing/ class=md-nav__link> <span class=md-ellipsis> Logging and auditing </span> </a> </li> <li class=md-nav__item> <a href=../../30-reference/configuration/dns/ class=md-nav__link> <span class=md-ellipsis> DNS </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../30-reference/configuration/cloud-pak/ class=md-nav__link> <span class=md-ellipsis> Cloud Paks </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_1_8> <label class=md-nav__link for=__nav_5_1_8 id=__nav_5_1_8_label tabindex=0> <span class=md-ellipsis> Cloud Pak for Data </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_5_1_8_label aria-expanded=false> <label class=md-nav__title for=__nav_5_1_8> <span class="md-nav__icon md-icon"></span> Cloud Pak for Data </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../30-reference/configuration/cp4d-cartridges/ class=md-nav__link> <span class=md-ellipsis> Cartridges </span> </a> </li> <li class=md-nav__item> <a href=../../30-reference/configuration/cp4d-instances/ class=md-nav__link> <span class=md-ellipsis> Instances </span> </a> </li> <li class=md-nav__item> <a href=../../30-reference/configuration/cp4d-connections/ class=md-nav__link> <span class=md-ellipsis> Platform connections </span> </a> </li> <li class=md-nav__item> <a href=../../30-reference/configuration/cp4d-access-control/ class=md-nav__link> <span class=md-ellipsis> Access Control </span> </a> </li> <li class=md-nav__item> <a href=../../30-reference/configuration/cp4d-assets/ class=md-nav__link> <span class=md-ellipsis> Assets </span> </a> </li> <li class=md-nav__item> <a href=../../30-reference/configuration/monitoring/ class=md-nav__link> <span class=md-ellipsis> Monitoring </span> </a> </li> <li class=md-nav__item> <a href=../../30-reference/configuration/logging-auditing/ class=md-nav__link> <span class=md-ellipsis> Logging and auditing </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../30-reference/configuration/cp4ba/ class=md-nav__link> <span class=md-ellipsis> Cloud Pak for Business Automation </span> </a> </li> <li class=md-nav__item> <a href=../../30-reference/configuration/private-registry/ class=md-nav__link> <span class=md-ellipsis> Private registries </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_2> <label class=md-nav__link for=__nav_5_2 id=__nav_5_2_label tabindex=0> <span class=md-ellipsis> Process </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_2_label aria-expanded=false> <label class=md-nav__title for=__nav_5_2> <span class="md-nav__icon md-icon"></span> Process </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../30-reference/process/overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../../30-reference/process/validate/ class=md-nav__link> <span class=md-ellipsis> Validate </span> </a> </li> <li class=md-nav__item> <a href=../../30-reference/process/prepare/ class=md-nav__link> <span class=md-ellipsis> Prepare </span> </a> </li> <li class=md-nav__item> <a href=../../30-reference/process/provision-infra/ class=md-nav__link> <span class=md-ellipsis> Provision infra </span> </a> </li> <li class=md-nav__item> <a href=../../30-reference/process/configure-infra/ class=md-nav__link> <span class=md-ellipsis> Configure infra </span> </a> </li> <li class=md-nav__item> <a href=../../30-reference/process/install-cloud-pak/ class=md-nav__link> <span class=md-ellipsis> Install Cloud Paks </span> </a> </li> <li class=md-nav__item> <a href=../../30-reference/process/configure-cloud-pak/ class=md-nav__link> <span class=md-ellipsis> Configure Cloud Paks </span> </a> </li> <li class=md-nav__item> <a href=../../30-reference/process/deploy-assets/ class=md-nav__link> <span class=md-ellipsis> Deploy assets </span> </a> </li> <li class=md-nav__item> <a href=../../30-reference/process/smoke-tests/ class=md-nav__link> <span class=md-ellipsis> Smoke tests </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../30-reference/timings/ class=md-nav__link> <span class=md-ellipsis> Timings </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Troubleshooting </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Troubleshooting </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../40-troubleshooting/cp4d-uninstall/ class=md-nav__link> <span class=md-ellipsis> Cloud Pak for Data uninstall </span> </a> </li> <li class=md-nav__item> <a href=../../40-troubleshooting/ibm-cloud-access-nfs-server/ class=md-nav__link> <span class=md-ellipsis> Access NFS server on IBM Cloud </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7 checked> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> Advanced </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=true> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Advanced </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../build-image-and-run-deployer-on-openshift/ class=md-nav__link> <span class=md-ellipsis> Build image and run deployer on OpenShift </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Private registry and air-gapped </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Private registry and air-gapped </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#use-case-1---mirror-images-and-install-using-a-bastion-server class=md-nav__link> <span class=md-ellipsis> Use case 1 - Mirror images and install using a bastion server </span> </a> <nav class=md-nav aria-label="Use case 1 - Mirror images and install using a bastion server"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#on-the-bastion-server class=md-nav__link> <span class=md-ellipsis> On the bastion server </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#use-case-2---mirror-images-with-an-internet-connected-server-install-using-a-bastion class=md-nav__link> <span class=md-ellipsis> Use case 2 - Mirror images with an internet-connected server, install using a bastion </span> </a> <nav class=md-nav aria-label="Use case 2 - Mirror images with an internet-connected server, install using a bastion"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#on-the-internet-connected-server class=md-nav__link> <span class=md-ellipsis> On the internet-connected server </span> </a> <nav class=md-nav aria-label="On the internet-connected server"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#diagram-step-1 class=md-nav__link> <span class=md-ellipsis> Diagram step 1 </span> </a> </li> <li class=md-nav__item> <a href=#diagram-step-2 class=md-nav__link> <span class=md-ellipsis> Diagram step 2 </span> </a> </li> <li class=md-nav__item> <a href=#diagram-step-3 class=md-nav__link> <span class=md-ellipsis> Diagram step 3 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#on-the-bastion-server_1 class=md-nav__link> <span class=md-ellipsis> On the bastion server </span> </a> <nav class=md-nav aria-label="On the bastion server"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#diagram-step-4 class=md-nav__link> <span class=md-ellipsis> Diagram step 4 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#use-case-3---mirror-images-using-a-portable-image-registry class=md-nav__link> <span class=md-ellipsis> Use case 3 - Mirror images using a portable image registry </span> </a> <nav class=md-nav aria-label="Use case 3 - Mirror images using a portable image registry"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#on-the-internet-connected-server_1 class=md-nav__link> <span class=md-ellipsis> On the internet-connected server </span> </a> <nav class=md-nav aria-label="On the internet-connected server"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#diagram-step-1_1 class=md-nav__link> <span class=md-ellipsis> Diagram step 1 </span> </a> </li> <li class=md-nav__item> <a href=#diagram-step-2_1 class=md-nav__link> <span class=md-ellipsis> Diagram step 2 </span> </a> </li> <li class=md-nav__item> <a href=#diagram-step-3_1 class=md-nav__link> <span class=md-ellipsis> Diagram step 3 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#on-the-bastion-server_2 class=md-nav__link> <span class=md-ellipsis> On the bastion server </span> </a> <nav class=md-nav aria-label="On the bastion server"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#diagram-step-4_1 class=md-nav__link> <span class=md-ellipsis> Diagram step 4 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#running-behind-a-proxy class=md-nav__link> <span class=md-ellipsis> Running behind a proxy </span> </a> </li> <li class=md-nav__item> <a href=#special-settings-for-debug-and-daemonset-images-in-air-gapped-mode class=md-nav__link> <span class=md-ellipsis> Special settings for debug and DaemonSet images in air-gapped mode </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../alternative-repo-reg/ class=md-nav__link> <span class=md-ellipsis> Using alternative CASE repositories and registries </span> </a> </li> <li class=md-nav__item> <a href=../advanced-configuration/ class=md-nav__link> <span class=md-ellipsis> Advanced configuration </span> </a> </li> <li class=md-nav__item> <a href=../locations-to-whitelist/ class=md-nav__link> <span class=md-ellipsis> Locations to whitelist </span> </a> </li> <li class=md-nav__item> <a href=../apply-node-settings-non-mco/ class=md-nav__link> <span class=md-ellipsis> Apply node settings to non-MCO clusters </span> </a> </li> <li class=md-nav__item> <a href=../cp4d-pre-release/ class=md-nav__link> <span class=md-ellipsis> Installing pre-releases of Cloud Pak for DAta </span> </a> </li> <li class=md-nav__item> <a href=../gitops/ class=md-nav__link> <span class=md-ellipsis> GitOps </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8 id=__nav_8_label tabindex=0> <span class=md-ellipsis> Development </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_8_label aria-expanded=false> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Development </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../80-development/deployer-development-setup/ class=md-nav__link> <span class=md-ellipsis> Deployer development setup </span> </a> </li> <li class=md-nav__item> <a href=../../80-development/doc-development-setup/ class=md-nav__link> <span class=md-ellipsis> Deployer documentation development setup </span> </a> </li> <li class=md-nav__item> <a href=../../80-development/doc-guidelines/ class=md-nav__link> <span class=md-ellipsis> Deployer documentation guidelines </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#use-case-1---mirror-images-and-install-using-a-bastion-server class=md-nav__link> <span class=md-ellipsis> Use case 1 - Mirror images and install using a bastion server </span> </a> <nav class=md-nav aria-label="Use case 1 - Mirror images and install using a bastion server"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#on-the-bastion-server class=md-nav__link> <span class=md-ellipsis> On the bastion server </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#use-case-2---mirror-images-with-an-internet-connected-server-install-using-a-bastion class=md-nav__link> <span class=md-ellipsis> Use case 2 - Mirror images with an internet-connected server, install using a bastion </span> </a> <nav class=md-nav aria-label="Use case 2 - Mirror images with an internet-connected server, install using a bastion"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#on-the-internet-connected-server class=md-nav__link> <span class=md-ellipsis> On the internet-connected server </span> </a> <nav class=md-nav aria-label="On the internet-connected server"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#diagram-step-1 class=md-nav__link> <span class=md-ellipsis> Diagram step 1 </span> </a> </li> <li class=md-nav__item> <a href=#diagram-step-2 class=md-nav__link> <span class=md-ellipsis> Diagram step 2 </span> </a> </li> <li class=md-nav__item> <a href=#diagram-step-3 class=md-nav__link> <span class=md-ellipsis> Diagram step 3 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#on-the-bastion-server_1 class=md-nav__link> <span class=md-ellipsis> On the bastion server </span> </a> <nav class=md-nav aria-label="On the bastion server"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#diagram-step-4 class=md-nav__link> <span class=md-ellipsis> Diagram step 4 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#use-case-3---mirror-images-using-a-portable-image-registry class=md-nav__link> <span class=md-ellipsis> Use case 3 - Mirror images using a portable image registry </span> </a> <nav class=md-nav aria-label="Use case 3 - Mirror images using a portable image registry"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#on-the-internet-connected-server_1 class=md-nav__link> <span class=md-ellipsis> On the internet-connected server </span> </a> <nav class=md-nav aria-label="On the internet-connected server"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#diagram-step-1_1 class=md-nav__link> <span class=md-ellipsis> Diagram step 1 </span> </a> </li> <li class=md-nav__item> <a href=#diagram-step-2_1 class=md-nav__link> <span class=md-ellipsis> Diagram step 2 </span> </a> </li> <li class=md-nav__item> <a href=#diagram-step-3_1 class=md-nav__link> <span class=md-ellipsis> Diagram step 3 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#on-the-bastion-server_2 class=md-nav__link> <span class=md-ellipsis> On the bastion server </span> </a> <nav class=md-nav aria-label="On the bastion server"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#diagram-step-4_1 class=md-nav__link> <span class=md-ellipsis> Diagram step 4 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#running-behind-a-proxy class=md-nav__link> <span class=md-ellipsis> Running behind a proxy </span> </a> </li> <li class=md-nav__item> <a href=#special-settings-for-debug-and-daemonset-images-in-air-gapped-mode class=md-nav__link> <span class=md-ellipsis> Special settings for debug and DaemonSet images in air-gapped mode </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=using-a-private-registry>Using a private registry<a class=headerlink href=#using-a-private-registry title="Permanent link">ðŸ”—</a></h1> <p>Some environments, especially in situations where the OpenShift cannot directly connect to the internet, require a private registry for OpenShift to pull the Cloud Pak images from. The Cloud Pak Deployer can mirror images from the entitled registry to a private registry that you want to use for the Cloud Pak(s). Also, if infrastructure which holds the OpenShift cluster is fully disconnected from the internet, the Cloud Pak Deployer can build a registry which can be stored on a portable hard disk or pen drive and then shipped to the site.</p> <div class="admonition info"> <p class=admonition-title>Info</p> <p>Note: In all cases, the deployer can work behind a proxy to access the internet. Go to <a href=#running-behind-a-proxy>Running behind proxy</a> for more information.</p> </div> <p>The below instructions are not limited to disconnected (air-gapped) OpenShift clusters, but are more generic for deployment using a private registry.</p> <p>There are three use cases for mirroring images to a private registry and using this to install the Cloud Pak(s):</p> <ul> <li><a href=#use-case-1---mirror-images-and-install-using-a-bastion-server>Use case 1 - Mirror images and install using a bastion server</a>. The bastion server can connect to the internet (directly or via a proxy), to OpenShift and to the private registry used by the OpenShift cluster.</li> <li><a href=#use-case-2---mirror-images-with-an-internet-connected-server-install-using-a-bastion>Use case 2 - Mirror images with a connected server, install using a bastion</a>. The connected server can connect to the internet and to the private registry used by the OpenShift cluster. The server cannot connect to the OpenShift cluster. The bastion server can connect to the private registry and to the OpenShift cluster.</li> <li><a href=#use-case-3---mirror-images-using-a-portable-image-registry>Use case 3 - Mirror images using a portable image registry</a>. The private registry used by the OpenShift cluster cannot be reached from the server that is connected to the internet. You need a portable registry to download images and which you then ship to a server that can connect to the <strong>existing</strong> OpenShift cluster and its private registry.</li> </ul> <p>Use cases 1 and 3 are also outlined in the Cloud Pak for Data installation documentation: <a href="https://www.ibm.com/docs/en/cloud-paks/cp-data/4.5.x?topic=tasks-mirroring-images-your-private-container-registry">https://www.ibm.com/docs/en/cloud-paks/cp-data/4.5.x?topic=tasks-mirroring-images-your-private-container-registry</a></p> <p>For specifying a private registry in the Cloud Pak Deployer configuration, please see <a href=../../../30-reference/configuration/private-registry>Private registry</a>. Example of specifying a private registry with a self-signed certificate in the configuration: <div class="copy highlight"><pre><span></span><code><span class=nt>image_registry</span><span class=p>:</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cpd453</span>
<span class=w>  </span><span class=nt>registry_host_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">registry.coc.ibm.com</span>
<span class=w>  </span><span class=nt>registry_port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5000</span>
<span class=w>  </span><span class=nt>registry_insecure</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
</code></pre></div></p> <p>The <code>cp4d</code> instance must reference the <code>image_registry</code> object using the <code>image_registry_name</code>: <div class="copy highlight"><pre><span></span><code><span class=nt>cp4d</span><span class=p>:</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>project</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">zen-45</span>
<span class=w>  </span><span class=nt>openshift_cluster_name</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{{</span><span class=w> </span><span class=nv>env_id</span><span class=w> </span><span class="p p-Indicator">}}</span>
<span class=w>  </span><span class=nt>cp4d_version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">4.5.3</span>
<span class=w>  </span><span class=nt>openshift_storage_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">odf-storage</span>
<span class=w>  </span><span class=nt>image_registry_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cpd453</span>
</code></pre></div></p> <div class="admonition info"> <p class=admonition-title>Info</p> <p>The deployer only supports using a private registry for the Cloud Pak images, not for OpenShift itself. Air-gapped installation of OpenShift is currently not in scope for the deployer.</p> </div> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>The <code>registry_host_name</code> you specify in the <code>image_registry</code> definition must also be available for DNS lookup within OpenShift. If the registry runs on a server that is not registered in the DNS, use its IP address instead of a host name.</p> </div> <p>The main 3 directories that are needed for both types of air-gapped installations are:</p> <ul> <li>Cloud Pak Deployer directory: <code>cloud-pak-deployer</code></li> <li>Configuration directory: The directory that holds a all the Cloud Pak Deployer configuration</li> <li>Status directory: The directory that will hold all downloads, vault secrets and the portable registry when applicable (use case 3)</li> </ul> <p>Fpr use cases 2 and 3, where the directories must be shipped to the air-gapped cluster, the <strong>Cloud Pak Deployer</strong> and <strong>Configuration</strong> directories will be stored in the <strong>Status</strong> directory for simplicity.</p> <h2 id=use-case-1---mirror-images-and-install-using-a-bastion-server>Use case 1 - Mirror images and install using a bastion server<a class=headerlink href=#use-case-1---mirror-images-and-install-using-a-bastion-server title="Permanent link">ðŸ”—</a></h2> <p>This is effectively "not-air-gapped" scenario, where the following conditions apply:</p> <ul> <li>The private registry is hosted inside the private dloud</li> <li>The bastion server can connect to the internet and mirror images to the private image registry</li> <li>The bastion server is optionally connected to the internet via a proxy server. See <a href=#running-behind-a-proxy>Running behind a proxy</a> for more details</li> <li>The bastion server can connect to OpenShift</li> </ul> <p><img alt=Not-air-gapped src=../images/not-air-gapped.png></p> <h3 id=on-the-bastion-server>On the bastion server<a class=headerlink href=#on-the-bastion-server title="Permanent link">ðŸ”—</a></h3> <p>The bastion server is connected to the internet and OpenShift cluster.</p> <ul> <li>If there are restrictions regarding the internet sites that can be reached, ensure that the website domains the deployer needs are whitelisted. For a list of domains, check <a href=../../50-advanced/locations-to-whitelist>locations to whitelist</a></li> <li>If a proxy server is configured for the bastion node, check the settings (<code>http_proxy</code>, <code>https_proxy</code>, <code>no_proxy</code> environment variables)</li> <li>Build the Cloud Pak Deployer image using <code>cp-deploy.sh build</code></li> <li>Create or update the directory with the configuration; make sure all your Cloud Paks and cartridges are specified as well as an <code>image_registry</code> entry to identify the private registry</li> <li>Export the CONFIG_DIR and STATUS_DIR environment variables to respectively point to the configuration directory and the status directory</li> <li>Export the CP_ENTITLEMENT_KEY environment variable with your Cloud Pak entitlement key</li> <li> <p>Create a vault secret <code>image-registry-&lt;name&gt;</code> holding the connection credentials for the private registry specified in the configuration (<code>image_registry</code>). For example for a registry definition with name <code>cpd453</code>, create secret <code>image-registry-cpd453</code>. <div class="copy highlight"><pre><span></span><code>cp-deploy.sh<span class=w> </span>vault<span class=w> </span><span class=nb>set</span><span class=w> </span><span class=se>\</span>
<span class=w>    </span>-vs<span class=w> </span>image-registry-cpd453<span class=w> </span><span class=se>\</span>
<span class=w>    </span>-vsv<span class=w> </span><span class=s2>&quot;admin:very_s3cret&quot;</span>
</code></pre></div></p> </li> <li> <p>Set the environment variable for the <code>oc login</code> command. For example: <div class="copy highlight"><pre><span></span><code><span class=nb>export</span><span class=w> </span><span class=nv>CPD_OC_LOGIN</span><span class=o>=</span><span class=s2>&quot;oc login api.pluto-01.coc.ibm.com:6443 -u kubeadmin -p BmxQ5-KjBFx-FgztG-gpTF3 --insecure-skip-tls-verify&quot;</span>
</code></pre></div></p> </li> <li> <p>Run the <code>cp-deploy.sh env apply</code> command to start deployment of the Cloud Pak to the OpenShift cluster. For example: <div class="copy highlight"><pre><span></span><code>cp-deploy.sh<span class=w> </span>env<span class=w> </span>apply
</code></pre></div> The existence of the <code>image_registry</code> definition and its reference in the <code>cp4d</code> definition instruct the deployer to mirror images to the private registry and to configure the OpenShift cluster to pull images from the private registry. If you have already mirrored the Cloud Pak images, you can add the <code>--skip-mirror-images</code> parameter to speed up the deployment process.</p> </li> </ul> <h2 id=use-case-2---mirror-images-with-an-internet-connected-server-install-using-a-bastion>Use case 2 - Mirror images with an internet-connected server, install using a bastion<a class=headerlink href=#use-case-2---mirror-images-with-an-internet-connected-server-install-using-a-bastion title="Permanent link">ðŸ”—</a></h2> <p>This use case is also sometimes referred to as "semi-air-gapped", where the following conditions apply:</p> <ul> <li>The private registry is hosted outside of the private cloud that hosts the bastion server and OpenShift</li> <li>An internet-connected server external to the private cloud can reach the entitled registry and the private registry</li> <li>The internet-connected server is optionally connected to the internet via a proxy server. See <a href=#running-behind-a-proxy>Running behind a proxy</a> for more details</li> <li>The bastion server <strong>cannot</strong> connect to the internet</li> <li>The bastion server can connect to OpenShift</li> </ul> <p><img alt=Semi-air-gapped src=../images/semi-air-gapped.png></p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>Please note that in this case the Cloud Pak Deployer expects an OpenShift cluster to be available already and will only work with an <code>existing-ocp</code> configuration. The bastion server does not have access to the internet and can therefore not instantiate an OpenShift cluster.</p> </div> <h3 id=on-the-internet-connected-server>On the internet-connected server<a class=headerlink href=#on-the-internet-connected-server title="Permanent link">ðŸ”—</a></h3> <ul> <li>If there are restrictions regarding the internet sites that can be reached, ensure that the website domains the deployer needs are whitelisted. For a list of domains, check <a href=../../50-advanced/locations-to-whitelist>locations to whitelist</a></li> <li>If a proxy server is configured for the internet-connected server, check the settings (<code>http_proxy</code>, <code>https_proxy</code>, <code>no_proxy</code> environment variables)</li> <li>Build the Cloud Pak Deployer image using <code>cp-deploy.sh build</code></li> <li>Create or update the directory with the configuration; make sure all your Cloud Paks and cartridges are specified as well as an <code>image_registry</code> entry to identify the private registry</li> <li>Export the CONFIG_DIR and STATUS_DIR environment variables to respectively point to the configuration directory and the status directory</li> <li>Export the CP_ENTITLEMENT_KEY environment variable with your Cloud Pak entitlement key</li> <li>Create a vault secret <code>image-registry-&lt;name&gt;</code> holding the connection credentials for the private registry specified in the configuration (<code>image_registry</code>). For example for a registry definition with name <code>cpd453</code>, create secret <code>image-registry-cpd453</code>. <div class="copy highlight"><pre><span></span><code>cp-deploy.sh<span class=w> </span>vault<span class=w> </span><span class=nb>set</span><span class=w> </span><span class=se>\</span>
<span class=w>    </span>-vs<span class=w> </span>image-registry-cpd453<span class=w> </span><span class=se>\</span>
<span class=w>    </span>-vsv<span class=w> </span><span class=s2>&quot;admin:very_s3cret&quot;</span>
</code></pre></div> If the status directory does not exist it is created at this point.</li> </ul> <h4 id=diagram-step-1>Diagram step 1<a class=headerlink href=#diagram-step-1 title="Permanent link">ðŸ”—</a></h4> <ul> <li> <p>Run the deployer using the <code>cp-deploy.sh env download --skip-portable-registry</code> command. For example: <div class="copy highlight"><pre><span></span><code>cp-deploy.sh<span class=w> </span>env<span class=w> </span>download<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--skip-portable-registry
</code></pre></div> This will download all clients to the status directory and then mirror images from the entitled registry to the private registry. If mirroring fails, fix the issue and just run the <code>env download</code> again.</p> </li> <li> <p>Before saving the status directory, you can optionally remove the entitlement key from the vault: <div class="copy highlight"><pre><span></span><code>cp-deploy.sh<span class=w> </span>vault<span class=w> </span>delete<span class=w> </span><span class=se>\</span>
<span class=w>    </span>-vs<span class=w> </span>ibm_cp_entitlement_key
</code></pre></div></p> </li> </ul> <h4 id=diagram-step-2>Diagram step 2<a class=headerlink href=#diagram-step-2 title="Permanent link">ðŸ”—</a></h4> <p>When the download finished successfully, the status directory holds the deployer scripts, the configuration directory and the deployer container image.</p> <h4 id=diagram-step-3>Diagram step 3<a class=headerlink href=#diagram-step-3 title="Permanent link">ðŸ”—</a></h4> <p>Ship the status directory from the internet-connected server to the bastion server.</p> <p>You can use tar with gzip mode or any other compression technique. The total size of the directories should be relatively small, typically &lt; 5 GB</p> <h3 id=on-the-bastion-server_1>On the bastion server<a class=headerlink href=#on-the-bastion-server_1 title="Permanent link">ðŸ”—</a></h3> <p>The bastion server is not connected to the internet but is connected to the private registry and the OpenShift cluster.</p> <h4 id=diagram-step-4>Diagram step 4<a class=headerlink href=#diagram-step-4 title="Permanent link">ðŸ”—</a></h4> <p>We're using the instructions in <a href=../../10-use-deployer/3-run/existing-openshift>Run on existing OpenShift</a>, adding the <code>--air-gapped</code> and <code>--skip-mirror-images</code> flags, to start the deployer:</p> <ul> <li>Restore the status directory onto the bastion server</li> <li>Export the STATUS_DIR environment variable to point to the status directory</li> <li> <p>Untar the <code>cloud-pak-deployer</code> scripts, for example: <div class="copy highlight"><pre><span></span><code>tar<span class=w> </span>xvzf<span class=w> </span><span class=nv>$STATUS_DIR</span>/cloud-pak-deployer.tar.gz
</code></pre></div></p> </li> <li> <p>Set the CPD_AIRGAP environment variable to <code>true</code> <div class="copy highlight"><pre><span></span><code><span class=nb>export</span><span class=w> </span><span class=nv>CPD_AIRGAP</span><span class=o>=</span><span class=nb>true</span>
</code></pre></div></p> </li> <li> <p>Set the environment variable for the <code>oc login</code> command. For example: <div class="copy highlight"><pre><span></span><code><span class=nb>export</span><span class=w> </span><span class=nv>CPD_OC_LOGIN</span><span class=o>=</span><span class=s2>&quot;oc login api.pluto-01.coc.ibm.com:6443 -u kubeadmin -p BmxQ5-KjBFx-FgztG-gpTF3 --insecure-skip-tls-verify&quot;</span>
</code></pre></div></p> </li> <li> <p>Run the <code>cp-deploy.sh env apply --skip-mirror-images</code> command to start deployment of the Cloud Pak to the OpenShift cluster. For example: <div class="copy highlight"><pre><span></span><code><span class=nb>cd</span><span class=w> </span>cloud-pak-deployer
cp-deploy.sh<span class=w> </span>env<span class=w> </span>apply<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--skip-mirror-images
</code></pre></div></p> </li> </ul> <p>The <code>CPD_AIRGGAP</code> environment variable tells the deployer it will not download anything from the internet; <code>--skip-mirror-images</code> indicates that images are already available in the private registry that is included in the configuration (<code>image_registry</code>)</p> <h2 id=use-case-3---mirror-images-using-a-portable-image-registry>Use case 3 - Mirror images using a portable image registry<a class=headerlink href=#use-case-3---mirror-images-using-a-portable-image-registry title="Permanent link">ðŸ”—</a></h2> <p>This use case is also usually referred to as "air-gapped", where the following conditions apply:</p> <ul> <li>The private registry is hosted in the private cloud that hosts the bastion server and OpenShift</li> <li>The bastion server <strong>cannot</strong> connect to the internet</li> <li>The bastion server can connect to the private registry and the OpenShift cluster</li> <li>The internet-connected server <strong>cannot</strong> connect to the private cloud</li> <li>The internet-connected server is optionally connected to the internet via a proxy server. See <a href=#running-behind-a-proxy>Running behind a proxy</a> for more details</li> <li>You need a portable registry to fill the private registry with the Cloud Pak images</li> </ul> <p><img alt="Air-gapped using portable registry" src=../images/air-gapped-portable.png></p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>Please note that in this case the Cloud Pak Deployer expects an OpenShift cluster to be available already and will only work with an <code>existing-ocp</code> configuration. The bastion server does not have access to the internet and can therefore not instantiate an OpenShift cluster.</p> </div> <h3 id=on-the-internet-connected-server_1>On the internet-connected server<a class=headerlink href=#on-the-internet-connected-server_1 title="Permanent link">ðŸ”—</a></h3> <ul> <li>If there are restrictions regarding the internet sites that can be reached, ensure that the website domains the deployer needs are whitelisted. For a list of domains, check <a href=../../../50-advanced/locations-to-whitelist>locations to whitelist</a></li> <li>If a proxy server is configured for the bastion node, check the settings (<code>http_proxy</code>, <code>https_proxy</code>, <code>no_proxy</code> environment variables)</li> <li>Build the Cloud Pak Deployer image using <code>cp-deploy.sh build</code></li> <li>Create or update the directory with the configuration, making sure all your Cloud Paks and cartridges are specified</li> <li>Export the CONFIG_DIR and STATUS_DIR environment variables to respectively point to the configuration directory and the status directory</li> <li>Export the CP_ENTITLEMENT_KEY environment variable with your Cloud Pak entitlement key</li> </ul> <h4 id=diagram-step-1_1>Diagram step 1<a class=headerlink href=#diagram-step-1_1 title="Permanent link">ðŸ”—</a></h4> <ul> <li> <p>Run the deployer using the <code>cp-deploy.sh env download</code> command. For example: <div class="copy highlight"><pre><span></span><code>cp-deploy.sh<span class=w> </span>env<span class=w> </span>download
</code></pre></div> This will download all clients, start the portable registry and then mirror images from the entitled registry to the <strong>portable registry</strong>. The portable registry data is kept in the status directory. If mirroring fails, fix the issue and just run the <code>env download</code> again.</p> </li> <li> <p>Before saving the status directory, you can optionally remove the entitlement key from the vault: <div class="copy highlight"><pre><span></span><code>cp-deploy.sh<span class=w> </span>vault<span class=w> </span>delete<span class=w> </span><span class=se>\</span>
<span class=w>    </span>-vs<span class=w> </span>ibm_cp_entitlement_key
</code></pre></div></p> </li> </ul> <p>See the download of watsonx.ai in action:</p> <video src=https://ibm.box.com/shared/static/swgaprvr9uvy3f4483jqgls4ntc962ws.mp4 controls=controls muted=muted class="d-block rounded-bottom-2 border-top width-fit" style="max-height:300px; min-height: 200px"></video> <h4 id=diagram-step-2_1>Diagram step 2<a class=headerlink href=#diagram-step-2_1 title="Permanent link">ðŸ”—</a></h4> <p>When the download finished successfully, the status directory holds the deployer scripts, the configuration directory, the deployer container image and the portable registry.</p> <h4 id=diagram-step-3_1>Diagram step 3<a class=headerlink href=#diagram-step-3_1 title="Permanent link">ðŸ”—</a></h4> <p>Ship the status directory from the internet-connected server to the bastion server.</p> <p>You can use tar with gzip mode or any other compression technique. The status directory now holds all assets required for the air-gapped installation and its size can be substantial (100+ GB). You may want to use multi-volume tar files if you are using network transfer. </p> <h3 id=on-the-bastion-server_2>On the bastion server<a class=headerlink href=#on-the-bastion-server_2 title="Permanent link">ðŸ”—</a></h3> <p>The bastion server is not connected to the internet but is connected to the private registry and OpenShift cluster.</p> <h4 id=diagram-step-4_1>Diagram step 4<a class=headerlink href=#diagram-step-4_1 title="Permanent link">ðŸ”—</a></h4> <p>See the air-gapped installation of Cloud Pak for Data in action:</p> <video src=https://ibm.box.com/shared/static/ldu9r6peftc037z1ydwawj5b26thk8kz.mp4 controls=controls muted=muted class="d-block rounded-bottom-2 border-top width-fit" style="max-height:300px; min-height: 200px"></video> <p>For the demonstration video, the download of the previous step has first been re-run to only download the Cloud Pak for Data control plane to avoid having to ship and upload ~700 GB.</p> <p>We're using the instructions in <a href=../../10-use-deployer/3-run/existing-openshift>Run on existing OpenShift</a>, adding the CPD_AIRGAP environment variable.</p> <ul> <li>Restore the status directory onto the bastion server. Make sure the volume to which you restore has enough space to hold the entire status directory, which includes the portable registry.</li> <li>Export the STATUS_DIR environment variable to point to the status directory</li> <li> <p>Untar the <code>cloud-pak-deployer</code> scripts, for example: <div class="copy highlight"><pre><span></span><code>tar<span class=w> </span>xvzf<span class=w> </span><span class=nv>$STATUS_DIR</span>/cloud-pak-deployer.tar.gz
<span class=nb>cd</span><span class=w> </span>cloud-pak-deployer
</code></pre></div></p> </li> <li> <p>Set the CPD_AIRGAP environment variable to <code>true</code> <div class="copy highlight"><pre><span></span><code><span class=nb>export</span><span class=w> </span><span class=nv>CPD_AIRGAP</span><span class=o>=</span><span class=nb>true</span>
</code></pre></div></p> </li> <li> <p>Set the environment variable for the <code>oc login</code> command. For example: <div class="copy highlight"><pre><span></span><code><span class=nb>export</span><span class=w> </span><span class=nv>CPD_OC_LOGIN</span><span class=o>=</span><span class=s2>&quot;oc login api.pluto-01.coc.ibm.com:6443 -u kubeadmin -p BmxQ5-KjBFx-FgztG-gpTF3 --insecure-skip-tls-verify&quot;</span>
</code></pre></div></p> </li> <li> <p>Create a vault secret <code>image-registry-&lt;name&gt;</code> holding the connection credentials for the private registry specified in the configuration (<code>image_registry</code>). For example for a registry definition with name <code>cpd453</code>, create secret <code>image-registry-cpd453</code>. <div class="copy highlight"><pre><span></span><code>cp-deploy.sh<span class=w> </span>vault<span class=w> </span><span class=nb>set</span><span class=w> </span><span class=se>\</span>
<span class=w>    </span>-vs<span class=w> </span>image-registry-cpd453<span class=w> </span><span class=se>\</span>
<span class=w>    </span>-vsv<span class=w> </span><span class=s2>&quot;admin:very_s3cret&quot;</span>
</code></pre></div></p> </li> <li> <p>Run the <code>cp-deploy.sh env apply</code> command to start deployment of the Cloud Pak to the OpenShift cluster. For example: <div class="copy highlight"><pre><span></span><code>cp-deploy.sh<span class=w> </span>env<span class=w> </span>apply
</code></pre></div> The <code>CPD_AIRGGAP</code> environment variable tells the deployer it will not download anything from the internet. As a first action, the deployer mirrors images from the portable registry to the private registry included in the configuration (<code>image_registry</code>)</p> </li> </ul> <h2 id=running-behind-a-proxy>Running behind a proxy<a class=headerlink href=#running-behind-a-proxy title="Permanent link">ðŸ”—</a></h2> <p>If the Cloud Pak Deployer is run from a server that has the HTTP proxy environment variables set up, i.e. "proxy" environment variables are configured on the server and in the terminal session, it will also apply these settings in the deployer container. </p> <p>The following environment variables are automatically applied to the deployer container if set up in the session running the <code>cp-deploy.sh</code> command:</p> <ul> <li><code>http_proxy</code></li> <li><code>https_proxy</code></li> <li><code>no_proxy</code></li> </ul> <p>If you do not want the deployer to use the proxy environment variables, you must remove them before running the <code>cp-deploy.sh</code> command: <div class="copy highlight"><pre><span></span><code><span class=nb>unset</span><span class=w> </span>http_proxy
<span class=nb>unset</span><span class=w> </span>https_proxy
<span class=nb>unset</span><span class=w> </span>no_proxy
</code></pre></div></p> <h2 id=special-settings-for-debug-and-daemonset-images-in-air-gapped-mode>Special settings for debug and DaemonSet images in air-gapped mode<a class=headerlink href=#special-settings-for-debug-and-daemonset-images-in-air-gapped-mode title="Permanent link">ðŸ”—</a></h2> <p>Specifically when running the deployer on IBM Cloud ROKS, certain OpenShift settings must be applied using DaemonSets in the <code>kube-system</code> namespace. Additionally, the deployer uses the <code>oc debug node</code> commands to retrieve <code>kubelet</code> and <code>crio</code> configuration files from the compute nodes.</p> <p>The default container images used by the DaemonSets and <code>oc debug node</code> commands are based on Red Hat's Universal Base Image and will be pulled from Red Hat registries. This is typically not possible in air-gapped installations, hence different images must be used. It is your responsibility to copy suitable (preferably UBI) images to an image registry that is connected to the OpenShift cluster. Also, if a pull secret is needed to pull the image(s) from the registry, you must create the associated secret in the <code>kube-system</code> OpenShift project.</p> <p>To configure alternative container images for the deployer to use, set the following properties in the <code>.inv</code> file kept in your configuration's <code>inventory</code> directory, or specify them as additional command line parameters for the <code>cp-deploy.sh</code> command. </p> <p>If you do not set these values, the deployer assumes that the default images are used for DaemonSet and <code>oc debug node</code>.</p> <table> <thead> <tr> <th>Property</th> <th>Description</th> <th>Example</th> </tr> </thead> <tbody> <tr> <td>cpd_oc_debug_image</td> <td>Container image to be used for the <code>oc debug</code> command.</td> <td><code>registry.redhat.io/rhel8/support-tools:latest</code></td> </tr> <tr> <td>cpd_ds_image</td> <td>Container image to be used for the DaemonSets that configure Kubelet, etc.</td> <td><code>icr.io/cpopen/cpd/olm-utils-v3:latest</code></td> </tr> </tbody> </table> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"annotate": null, "base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../assets/javascripts/bundle.79ae519e.min.js></script> <script src=../../js/open_in_new_tab.js></script> </body> </html>