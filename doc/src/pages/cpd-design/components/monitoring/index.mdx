---
title: Cloud Pak For Data Monitoring Overview
---

## Monitoring Cloud Pak for Data

For monitoring of Cloud Pak for Data we make use of the OpenShift Monitoring framework. The observations generated by Cloud Pak for Data are pushed to the OpenShift Monitoring Prometheus endpoint. This will allow (external) monitoring tools to combine the observations from the OpenShift platform and Cloud Pak for Data from a single source. 

![Monitoring overview](cloud-pak-deployer-monitors.png)


To deploy Cloud Pak for Data Monitors, its is mandatory to enable the OpenShift monitoring. OpenShift monitoring is activated via the `openshift_monitoring` object. For Cloud Pak for Data to be able to push its Prometheus metrics to OpenShift monitoring, the `user_worload` must be set to enabled. To make the openShift monitoring data persistent, the (optional) setting `pvc_storage_class` and `pvc_storage_size_gb` can be set. To enable Prometheus RemoteWrite, use the `remote_rewrite_url`. 

Optionally it is possible to install the community operator of Grafana, which provides the ability to build your own Grafana Dashboards. The `grafana_project` specifies the OpenShift project in which Grafana is deployed. The installation of Grafana creates a default local administrative user with username `root` and password `secret`. Grafana can be accessed via the OpenShift Route that is exposed in the `grafana_project`.

```
openshift_monitoring:
- openshift_cluster_name: pluto-01
  user_workload: enabled
  pvc_storage_class: ibmc-vpc-block-retain-general-purpose
  pvc_storage_size_gb: 100
  remote_rewrite_url: http://www.example.com:1234/receive
  grafana_operator: enabled
  grafana_project: grafana
```

The observations of Cloud Pak for Data are generated using the zen-watchdog component, which is part of the cpd_platform cartridge and therefore available on each instance of Cloud Pak for Data. Part of the zen-watchdog installation is a set of monitors which focus on the technical deployment of Cloud Pak for Data (e.g. running pods and bound Persistent Volume Claims (pvcs)).

## Add custom monitors

Additional monitors which focus more on the operational usage of Cloud Pak for Data can be deployed as well. Click on each monitor for a detailed description and the list of observations which are generated by the monitor. 
* [Global Platform connections](/cpd-design/components/monitoring/global-platform-connections)
* [Watson Studio - Runtimes](/cpd-design/components/monitoring/watson-studio-runtimes)

## Configuring custom monitors

Custom monitors are added via the `cpd_monitors` object, which contains a list of monitor sets. Each monitor set contains a set of default parameters, which can be overridden in the configuration of each monitor. 

```
cp4d_monitors:
- name: cp4d-monitor-set-1
  cp4d_instance: zen-40
  openshift_cluster_name: pluto-01
  default_monitor_source_repo: https://github.ibm.com/CloudPakDeployer/cloud-pak-deployer-monitors
  default_monitor_source_token_secret: monitors_source_repo_secret
  default_monitor_target_cr: de.icr.io/monitorrepo  
  default_monitor_target_cr_user_secret: monitors_target_cr_username
  default_monitor_target_cr_password_secret: monitors_target_cr_password
  # List of monitors
  monitors:
```

The monitors are kept in a github source repository, specified by the `default_monitor_source_repo`, the token to access the source repository should be available in the configured vault and is reference in the `default_monitor_source_token_secret`.

The Cloud Pak Deployer will use OpenShift S2i (Source to Image) to build the monitor. The resulting image can be pushed to either the internal image registry of OpenShift, or pushed to an external container registry, specified by the `default_monitor_target_cr`. If the `target_cr` parameters are omitted, the default internal image registry of OpenShift is used. 

```
  # List of monitors
  monitors:
  - name: cp4d-platform-global-connections
    #monitor_source_repo:             
    #monitor_source_token_secret:    
    #monitor_target_cr:              
    #monitor_target_cr_user_secret:  
    #monitor_target_cr_user_password:
    context: cp4d-platform-global-connections
    label: latest
    schedule: "*/15 * * * *"
    # List of monitor Event Types
    event_types:
```

The `monitors` contains the list of monitors. The `name` of the monitor must consist of lower case alphanumeric characters, - or ., and must start and end with an alphanumeric character.  
Each monitor can override the `default_` settings using the `monitor_source_repo`, `monitor_source_token_secret`, `monitor_target_cr`, `monitor_target_cr_user_secret` and `monitor_target_cr_user_password`.  
The `context` sets the subfolder in the github source repository where the monitor is available. The `label` sets the label of the pushed image, if omitted, it uses `latest`. The `schedule` set the interval of the cronjob that runs the monitor. 

<InlineNotification kind="info">
Be aware the running monitors requests system resources from the cluster. It is therefore important to set the interval of each monitor based on the expected changes made to the object(s) it monitors.
</InlineNotification>

```
    # List of monitor Event Types
    event_types:
    - name: "global_connections_count"
      simple_name: "Number of CP4D Platform connections"
      alert_type: "platform"
      short_description: "Number of CP4D Platform connections"
      long_description: "Number of CP4D Platform connections: <global_connections_count>"
      resolution: "none"
      reason_code_prefix: "80"
    - name: "global_connection_valid"
      simple_name: "Test CP4D Platform connection"
      alert_type: "platform"
      short_description: "Test CP4D Platform connection"
      long_description: "Test result CP4D Platform connection: <global_connection_valid>"
      resolution: "Validate the connection properties"
      reason_code_prefix: "80"
```

Each `monitors` entry **must** contain at least 1 `event_types`. The `event_types` represent the observations that will be generated by the monitor and the information that will be pushed to the OpenShift Monitoring component. The `name` can only contain lowercase, numbers and _ characters. The `simple_name`, `short_description` and `long_description` are using in the Cloud Pak for Data User interface, when displaying the events in the Alerts and Events page. The **item** in the long_description must be part of the `metadata` in the implementation of the monitor when construction the event payload. The `reason_code_prefix` is used for SNMP Alerts, it is recommended for custom monitors to use a custom prefix greater than 60.  